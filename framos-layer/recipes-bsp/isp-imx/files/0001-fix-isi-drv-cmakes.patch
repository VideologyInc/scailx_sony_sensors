From 424cb247deb54559f0b14654897dfb53e2a22ef5 Mon Sep 17 00:00:00 2001
From: Kobus Goosen <kgoosen@videologyinc.com>
Date: Thu, 3 Apr 2025 17:21:59 +0200
Subject: [PATCH] fix isi drv cmakes

---
 .../units/isi/drv/imx662/CMakeLists.txt           | 15 +++++++++------
 .../units/isi/drv/imx676/CMakeLists.txt           | 15 +++++++++------
 .../units/isi/drv/imx678/CMakeLists.txt           | 15 +++++++++------
 .../units/isi/drv/imx900/CMakeLists.txt           | 15 +++++++++------
 4 files changed, 36 insertions(+), 24 deletions(-)

diff --git a/isp-imx-4.2.2.24.1/units/isi/drv/imx662/CMakeLists.txt b/isp-imx-4.2.2.24.1/units/isi/drv/imx662/CMakeLists.txt
index ab0dd74..4210149 100644
--- a/isp-imx-4.2.2.24.1/units/isi/drv/imx662/CMakeLists.txt
+++ b/isp-imx-4.2.2.24.1/units/isi/drv/imx662/CMakeLists.txt
@@ -18,6 +18,7 @@ file(GLOB pub_headers include/*.h)
 include_directories(
     include
     include_priv
+    ${UNITS_TOP_DIRECTORY}
     ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/include
     )
 
@@ -38,6 +39,11 @@ SET_TARGET_PROPERTIES(${module}_shared PROPERTIES SOVERSION       ${${module}_IN
 SET_TARGET_PROPERTIES(${module}_shared PROPERTIES VERSION         ${${module}_INTERFACE_CURRENT}.${${module}_INTERFACE_REVISION}.${${module}_INTERFACE_AGE})
 SET_TARGET_PROPERTIES(${module}_shared PROPERTIES FRAMEWORK       TRUE PUBLIC_HEADER "${pub_headers}")
 
+if(${GENERATE_PARTITION_BUILD} STREQUAL 0)
+    # the first target of units partition build, which depends on the units header file copy
+    add_dependencies(${module}_shared copy_units_headers)
+endif(${GENERATE_PARTITION_BUILD} STREQUAL 0)
+
 # add convenience target: put sensor driver into the 'bin' output dir as well
 if ( NOT ANDROID )
 add_custom_target(${module}.drv
@@ -66,12 +72,9 @@ target_link_libraries(${module}_shared
                       isi_shared
                       )
 else (GENERATE_PARTITION_BUILD)
-target_link_libraries(${module}_shared
-                      ${android_partial_platform_libs}
-                      ${android_partial_base_libs}
-                      ${android_partial_drv_libs}
-                      isi_shared
-                      )
+foreach(lib IN LISTS android_partial_base_libs android_partial_platform_libs android_partial_drv_libs)
+    target_link_libraries(${module}_shared "${lib}.so")
+endforeach()
 add_library(PrebuiltLibs SHARED IMPORTED)
 set_target_properties(PrebuiltLibs PROPERTIES IMPORTED_LOCATION ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/lib/libhal.so)
 set_target_properties(PrebuiltLibs PROPERTIES IMPORTED_LOCATION ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/lib/libbufferpool.so)
diff --git a/isp-imx-4.2.2.24.1/units/isi/drv/imx676/CMakeLists.txt b/isp-imx-4.2.2.24.1/units/isi/drv/imx676/CMakeLists.txt
index 177f69d..3de1e45 100755
--- a/isp-imx-4.2.2.24.1/units/isi/drv/imx676/CMakeLists.txt
+++ b/isp-imx-4.2.2.24.1/units/isi/drv/imx676/CMakeLists.txt
@@ -18,6 +18,7 @@ file(GLOB pub_headers include/*.h)
 include_directories(
     include
     include_priv
+    ${UNITS_TOP_DIRECTORY}
     ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/include
     )
 
@@ -38,6 +39,11 @@ SET_TARGET_PROPERTIES(${module}_shared PROPERTIES SOVERSION       ${${module}_IN
 SET_TARGET_PROPERTIES(${module}_shared PROPERTIES VERSION         ${${module}_INTERFACE_CURRENT}.${${module}_INTERFACE_REVISION}.${${module}_INTERFACE_AGE})
 SET_TARGET_PROPERTIES(${module}_shared PROPERTIES FRAMEWORK       TRUE PUBLIC_HEADER "${pub_headers}")
 
+if(${GENERATE_PARTITION_BUILD} STREQUAL 0)
+    # the first target of units partition build, which depends on the units header file copy
+    add_dependencies(${module}_shared copy_units_headers)
+endif(${GENERATE_PARTITION_BUILD} STREQUAL 0)
+
 # add convenience target: put sensor driver into the 'bin' output dir as well
 if ( NOT ANDROID )
 add_custom_target(${module}.drv
@@ -66,12 +72,9 @@ target_link_libraries(${module}_shared
                       isi_shared
                       )
 else (GENERATE_PARTITION_BUILD)
-target_link_libraries(${module}_shared
-                      ${android_partial_platform_libs}
-                      ${android_partial_base_libs}
-                      ${android_partial_drv_libs}
-                      isi_shared
-                      )
+foreach(lib IN LISTS android_partial_base_libs android_partial_platform_libs android_partial_drv_libs)
+    target_link_libraries(${module}_shared "${lib}.so")
+endforeach()
 add_library(PrebuiltLibs SHARED IMPORTED)
 set_target_properties(PrebuiltLibs PROPERTIES IMPORTED_LOCATION ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/lib/libhal.so)
 set_target_properties(PrebuiltLibs PROPERTIES IMPORTED_LOCATION ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/lib/libbufferpool.so)
diff --git a/isp-imx-4.2.2.24.1/units/isi/drv/imx678/CMakeLists.txt b/isp-imx-4.2.2.24.1/units/isi/drv/imx678/CMakeLists.txt
index 5854c5c..ecc9b66 100755
--- a/isp-imx-4.2.2.24.1/units/isi/drv/imx678/CMakeLists.txt
+++ b/isp-imx-4.2.2.24.1/units/isi/drv/imx678/CMakeLists.txt
@@ -18,6 +18,7 @@ file(GLOB pub_headers include/*.h)
 include_directories(
     include
     include_priv
+    ${UNITS_TOP_DIRECTORY}
     ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/include
     )
 
@@ -38,6 +39,11 @@ SET_TARGET_PROPERTIES(${module}_shared PROPERTIES SOVERSION       ${${module}_IN
 SET_TARGET_PROPERTIES(${module}_shared PROPERTIES VERSION         ${${module}_INTERFACE_CURRENT}.${${module}_INTERFACE_REVISION}.${${module}_INTERFACE_AGE})
 SET_TARGET_PROPERTIES(${module}_shared PROPERTIES FRAMEWORK       TRUE PUBLIC_HEADER "${pub_headers}")
 
+if(${GENERATE_PARTITION_BUILD} STREQUAL 0)
+    # the first target of units partition build, which depends on the units header file copy
+    add_dependencies(${module}_shared copy_units_headers)
+endif(${GENERATE_PARTITION_BUILD} STREQUAL 0)
+
 # add convenience target: put sensor driver into the 'bin' output dir as well
 if ( NOT ANDROID )
 add_custom_target(${module}.drv
@@ -66,12 +72,9 @@ target_link_libraries(${module}_shared
                       isi_shared
                       )
 else (GENERATE_PARTITION_BUILD)
-target_link_libraries(${module}_shared
-                      ${android_partial_platform_libs}
-                      ${android_partial_base_libs}
-                      ${android_partial_drv_libs}
-                      isi_shared
-                      )
+foreach(lib IN LISTS android_partial_base_libs android_partial_platform_libs android_partial_drv_libs)
+    target_link_libraries(${module}_shared "${lib}.so")
+endforeach()
 add_library(PrebuiltLibs SHARED IMPORTED)
 set_target_properties(PrebuiltLibs PROPERTIES IMPORTED_LOCATION ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/lib/libhal.so)
 set_target_properties(PrebuiltLibs PROPERTIES IMPORTED_LOCATION ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/lib/libbufferpool.so)
diff --git a/isp-imx-4.2.2.24.1/units/isi/drv/imx900/CMakeLists.txt b/isp-imx-4.2.2.24.1/units/isi/drv/imx900/CMakeLists.txt
index a9e26ff..a8b7ee9 100755
--- a/isp-imx-4.2.2.24.1/units/isi/drv/imx900/CMakeLists.txt
+++ b/isp-imx-4.2.2.24.1/units/isi/drv/imx900/CMakeLists.txt
@@ -18,6 +18,7 @@ file(GLOB pub_headers include/*.h)
 include_directories(
     include
     include_priv
+    ${UNITS_TOP_DIRECTORY}
     ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/include
     )
 
@@ -38,6 +39,11 @@ SET_TARGET_PROPERTIES(${module}_shared PROPERTIES SOVERSION       ${${module}_IN
 SET_TARGET_PROPERTIES(${module}_shared PROPERTIES VERSION         ${${module}_INTERFACE_CURRENT}.${${module}_INTERFACE_REVISION}.${${module}_INTERFACE_AGE})
 SET_TARGET_PROPERTIES(${module}_shared PROPERTIES FRAMEWORK       TRUE PUBLIC_HEADER "${pub_headers}")
 
+if(${GENERATE_PARTITION_BUILD} STREQUAL 0)
+    # the first target of units partition build, which depends on the units header file copy
+    add_dependencies(${module}_shared copy_units_headers)
+endif(${GENERATE_PARTITION_BUILD} STREQUAL 0)
+
 # add convenience target: put sensor driver into the 'bin' output dir as well
 if ( NOT ANDROID )
 add_custom_target(${module}.drv
@@ -66,12 +72,9 @@ target_link_libraries(${module}_shared
                       isi_shared
                       )
 else (GENERATE_PARTITION_BUILD)
-target_link_libraries(${module}_shared
-                      ${android_partial_platform_libs}
-                      ${android_partial_base_libs}
-                      ${android_partial_drv_libs}
-                      isi_shared
-                      )
+foreach(lib IN LISTS android_partial_base_libs android_partial_platform_libs android_partial_drv_libs)
+    target_link_libraries(${module}_shared "${lib}.so")
+endforeach()
 add_library(PrebuiltLibs SHARED IMPORTED)
 set_target_properties(PrebuiltLibs PROPERTIES IMPORTED_LOCATION ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/lib/libhal.so)
 set_target_properties(PrebuiltLibs PROPERTIES IMPORTED_LOCATION ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/lib/libbufferpool.so)
-- 
2.34.1

